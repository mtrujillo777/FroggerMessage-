<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Message Delivery</title>

<style>
body {
  margin: 0;
  background: #020617;
  display: flex;
  justify-content: center;
  font-family: Arial, sans-serif;
}

#container {
  width: 390px;
  height: 844px;
  background: #020617;
  color: white;
  position: relative;
  overflow: hidden;
}

/* ---------- HUD ---------- */
#hud {
  height: 44px;
  padding: 10px;
  font-size: 16px;
}

/* ---------- START SCREEN ---------- */
#startScreen {
  position: absolute;
  inset: 0;
  background: #020617;
  padding: 20px;
  z-index: 10;
  text-align: center;
}

#startScreen h1 {
  font-size: 24px;
}

#startScreen p {
  font-size: 14px;
  line-height: 1.5;
}

button {
  margin-top: 16px;
  padding: 12px 20px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #22c55e;
}

/* ---------- GAME AREA ---------- */
#game {
  width: 100%;
  height: 656px;
  position: relative;
}

/* Lanes */
.lane {
  position: absolute;
  width: 100%;
  height: 70px;
}

.safe { background: #020617; }
.road { background: #1e293b; }
.river { background: #0f172a; }
.goal { background: #14532d; }

/* Player */
#player {
  width: 32px;
  height: 32px;
  position: absolute;
  font-size: 28px;
  text-align: center;
}

/* Entities */
.entity {
  position: absolute;
  font-size: 26px;
}

/* ---------- CONTROLS ---------- */
#controls {
  display: grid;
  grid-template-columns: 80px 80px 80px;
  grid-template-rows: 60px 60px 60px;
  gap: 6px;
  justify-content: center;
  padding: 10px;
}

.control {
  background: #334155;
  border-radius: 12px;
  border: none;
  font-size: 22px;
  color: white;
}

.empty {
  background: transparent;
}
</style>
</head>

<body>

<div id="container">

<!-- HUD -->
<div id="hud">
  Score: <span id="score">0</span>
</div>

<!-- START SCREEN -->
<div id="startScreen">
  <h1>Message Delivery</h1>
  <p>
    Deliver your message through a distracted audience.
    <br><br>
    üì± üó£Ô∏è ‚è∞ = Distractions  
    <br>
    üëÄ ‚è∏Ô∏è = Supportive cues
    <br><br>
    Move deliberately. Timing matters.
  </p>
  <button onclick="startGame()">Start</button>
</div>

<!-- GAME -->
<div id="game"></div>

<!-- CONTROLS (CROSS LAYOUT) -->
<div id="controls">
  <div class="empty"></div>
  <button class="control" onclick="move(0,-70)">‚¨ÜÔ∏è</button>
  <div class="empty"></div>

  <button class="control" onclick="move(-70,0)">‚¨ÖÔ∏è</button>
  <div class="empty"></div>
  <button class="control" onclick="move(70,0)">‚û°Ô∏è</button>

  <div class="empty"></div>
  <button class="control" onclick="move(0,70)">‚¨áÔ∏è</button>
  <div class="empty"></div>
</div>

</div>

<script>
const game = document.getElementById("game");
const laneHeight = 70;
let player;
let entities = [];
let gameRunning = false;
let score = 0;

/* ---------- LANE DEFINITIONS ---------- */
const lanes = [
  { type: "goal" },
  { type: "river" },
  { type: "river" },
  { type: "road" },
  { type: "road" },
  { type: "safe" },
  { type: "road" },
  { type: "road" },
  { type: "safe" }
];

function buildLanes() {
  lanes.forEach((lane, i) => {
    const l = document.createElement("div");
    l.className = `lane ${lane.type}`;
    l.style.top = (i * laneHeight) + "px";
    game.appendChild(l);
  });
}

/* ---------- START GAME ---------- */
function startGame() {
  document.getElementById("startScreen").style.display = "none";
  game.innerHTML = "";
  entities = [];
  gameRunning = true;
  score = 0;
  updateScore();

  buildLanes();
  spawnEntities();

  player = document.createElement("div");
  player.id = "player";
  player.innerHTML = "üé§";
  player.style.left = "180px";
  player.style.top = "560px";
  game.appendChild(player);

  requestAnimationFrame(update);
}

/* ---------- SPAWN ENTITIES ---------- */
function spawnEntities() {
  lanes.forEach((lane, i) => {
    if (lane.type === "road") {
      spawnRow(i, ["üì±","üó£Ô∏è","‚è∞"], randomSpeed(), false);
    }
    if (lane.type === "river") {
      spawnRow(i, ["üëÄ","‚è∏Ô∏è"], randomSpeed(), true);
    }
  });
}

function spawnRow(row, icons, speed, isLog) {
  for (let i = 0; i < 3; i++) {
    let e = document.createElement("div");
    e.className = "entity";
    e.innerHTML = icons[Math.floor(Math.random()*icons.length)];
    e.dataset.speed = speed;
    e.dataset.log = isLog;
    e.style.top = (row * laneHeight + 20) + "px";
    e.style.left = (i * 140) + "px";
    game.appendChild(e);
    entities.push(e);
  }
}

function randomSpeed() {
  return (Math.random() > 0.5 ? 1 : -1) * (1.2 + Math.random());
}

/* ---------- PLAYER MOVE ---------- */
function move(dx, dy) {
  if (!gameRunning) return;

  let x = parseInt(player.style.left) + dx;
  let y = parseInt(player.style.top) + dy;

  if (x < 0 || x > 358 || y < 0 || y > 630) return;

  player.style.left = x + "px";
  player.style.top = y + "px";

  score += 10;
  updateScore();

  checkState();
}

/* ---------- GAME LOOP ---------- */
function update() {
  if (!gameRunning) return;

  entities.forEach(e => {
    let x = parseFloat(e.style.left);
    x += parseFloat(e.dataset.speed);
    if (x > 390) x = -40;
    if (x < -40) x = 390;
    e.style.left = x + "px";
  });

  checkState();
  requestAnimationFrame(update);
}

/* ---------- COLLISION ---------- */
function checkState() {
  let pRect = player.getBoundingClientRect();
  let onLog = false;

  for (let e of entities) {
    let r = e.getBoundingClientRect();
    if (intersect(pRect, r)) {
      if (e.dataset.log === "true") {
        onLog = true;
        player.style.left =
          (parseFloat(player.style.left) + parseFloat(e.dataset.speed)) + "px";
      } else {
        lose();
        return;
      }
    }
  }

  let row = Math.floor(parseInt(player.style.top) / laneHeight);

  if (lanes[row].type === "river" && !onLog) lose();
  if (lanes[row].type === "goal") win();
}

function intersect(a,b) {
  return !(a.right < b.left || a.left > b.right ||
           a.bottom < b.top || a.top > b.bottom);
}

/* ---------- END STATES ---------- */
function win() {
  gameRunning = false;
  alert(`‚úÖ Message Delivered!\nFinal Score: ${score}`);
  reset();
}

function lose() {
  gameRunning = false;
  alert(`üòî Message Lost\nFinal Score: ${score}`);
  reset();
}

function reset() {
  document.getElementById("startScreen").style.display = "block";
}

/* ---------- SCORE ---------- */
function updateScore() {
  document.getElementById("score").textContent = score;
}
</script>

</body>
</html>
